[phases.setup]
nixPkgs = ["python3", "android-tools", "tailscale", "coreutils"]

[phases.prestart]
cmds = [
  # Using full path to mkdir from the Nix profile
  '/nix/var/nix/profiles/default/bin/mkdir -p /root/.android',
  'echo "$ADB_PRIVATE_KEY" > /root/.android/adbkey',
  'echo "$ADB_PUBLIC_KEY" > /root/.android/adbkey.pub',
  'chmod 600 /root/.android/adbkey'
]

[phases.build]
cmds = [
  "pip install -r requirements.txt",
  "echo '--- DEBUG: LOCATING BINARIES ---'",
  "which tailscale || echo 'tailscale not in path'",
  "which adb || echo 'adb not in path'"
]

[variables]
# This forces the Nix bin paths into the environment for the runtime
PATH = "$PATH:/root/.nix-profile/bin:/nix/var/nix/profiles/default/bin"