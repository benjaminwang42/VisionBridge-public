[phases.setup]
nixPkgs = ["python3", "android-tools", "tailscale"]

[phases.build]
cmds = [
  "pip install -r requirements.txt",
  "echo '--- DEBUG: LOCATING BINARIES ---'",
  "find /nix/store -name tailscale -type f -executable -maxdepth 4 2>/dev/null | head -n 5",
  "find /nix/store -name adb -type f -executable -maxdepth 4 2>/dev/null | head -n 5",
  "ls -l /root/.nix-profile/bin/tailscale || echo 'Not in root profile'",
  "ls -l /nix/var/nix/profiles/default/bin/tailscale || echo 'Not in default profile'"
]

[phases.prestart]
cmds = [
  'mkdir -p /root/.android',
  'echo "$ADB_PRIVATE_KEY" > /root/.android/adbkey',
  'echo "$ADB_PUBLIC_KEY" > /root/.android/adbkey.pub',
  'chmod 600 /root/.android/adbkey'
]

[variables]
PATH = "$PATH:/root/.nix-profile/bin:/nix/var/nix/profiles/default/bin:/usr/local/bin"